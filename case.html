<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>جزئیات پرونده</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .back-btn { display:inline-block;margin:1rem;color:#fff;text-decoration:none;font-weight:600; }
    .media-gallery { display:flex; flex-wrap:wrap; gap:10px; margin-top:1rem; }
    .media-gallery img, .media-gallery video { width:calc(50% - 10px); border-radius:12px; cursor:pointer; }
    .lightbox { position:fixed; top:0; left:0;width:100%;height:100%; background:rgba(0,0,0,0.85); display:flex; align-items:center; justify-content:center; z-index:9999; }
    .lightbox.hidden { display:none; }
    .lightbox-content img, .lightbox-content video { max-width:90%; max-height:90%; border-radius:12px; }
    .lightbox .close { position:absolute; top:1rem; right:1rem; font-size:2rem; color:#fff; cursor:pointer; }
  </style>
</head>
<body>

<a href="index.html" class="back-btn">← بازگشت</a>
<header>
  <h1>جزئیات افشا</h1>
</header>

<main id="case-detail"></main>

<footer>
  Designer - Developer : ELMAN
</footer>

<!-- کامنت ها -->
<div id="comments"></div>

<!-- lightbox -->
<div id="lightbox" class="lightbox hidden">
  <span class="close">×</span>
  <div class="lightbox-content"></div>
</div>

<!-- JS -->
<script type="module">
async function loadCase() {
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  if (!id) return;

  const res = await fetch('./cases.json?v=' + Date.now());
  const cases = await res.json();
  const c = cases.find(x => x.id === id);
  if (!c) return;

  const container = document.getElementById('case-detail');

  // محتوای پرونده
  container.innerHTML = `
    <div class="case-card">
      <h2>${c.title}</h2>
      <div class="case-meta" ${c.date}</div>
      <div class="case-desc">${c.desc.replace(/\n/g, "<br>")}</div>
      <div class="media-gallery"></div>
    </div>
  `;

  const gallery = container.querySelector('.media-gallery');

  // اضافه کردن عکس و ویدیو
  c.media.forEach(m => {
    if(m.type === 'image') {
      const img = document.createElement('img');
      img.src = m.src;
      gallery.appendChild(img);
      img.addEventListener('click', ()=>openLightbox(img));
    } else if(m.type === 'video') {
      const vid = document.createElement('video');
      vid.src = m.src;
      vid.controls = true;
      gallery.appendChild(vid);
      vid.addEventListener('click', ()=>openLightbox(vid.cloneNode(true)));
    }
  });
}

// Lightbox
const lightbox = document.getElementById('lightbox');
const lightboxContent = lightbox.querySelector('.lightbox-content');
function openLightbox(el){
  lightboxContent.innerHTML = '';
  lightboxContent.appendChild(el.cloneNode(true));
  lightbox.classList.remove('hidden');
}
lightbox.querySelector('.close').addEventListener('click', ()=>lightbox.classList.add('hidden'));

// لود کردن پرونده
document.addEventListener('DOMContentLoaded', loadCase);
</script>

<div id="comments"></div>

<script src="https://utteranc.es/client.js"
        repo="Elmansa/Toiletbeinrahi-"
        issue-term="pathname"
        label="tcomment"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
</script>

</body>
</html>
